{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var d=Object.create;var i=Object.defineProperty;var c=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var o=n=>i(n,\"__esModule\",{value:!0});var u=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),b=(n,e)=>{o(n);for(var t in e)i(n,t,{get:e[t],enumerable:!0})},f=(n,e,t)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of h(e))!m.call(n,r)&&r!==\"default\"&&i(n,r,{get:()=>e[r],enumerable:!(t=c(e,r))||t.enumerable});return n},w=n=>f(o(i(n!=null?d(p(n)):{},\"default\",n&&n.__esModule&&\"default\"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var l=u((G,s)=>{s.exports=_jsx_runtime});var I={};b(I,{default:()=>y,frontmatter:()=>g});var a=w(l()),g={title:\"Multi developer environments on AWS using Gitlab + Terraform + Serverless + React\",date:\"2020-05-06\",tags:[\"serverless\",\"gitlab\",\"terraform\",\"react\",\"aws\"],draft:!1,summary:\"How you can deploy your applications and separate them by developer using Terraform and Gitlab CI.\"};function v(n){let e=Object.assign({h1:\"h1\",a:\"a\",span:\"span\",p:\"p\",img:\"img\",strong:\"strong\",em:\"em\",h2:\"h2\",h3:\"h3\"},n.components),{wrapper:t}=e,r=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e.h1,{id:\"multi-developer-environments-on-aws-using-gitlab--terraform--serverless--react\",children:[(0,a.jsx)(e.a,{href:\"#multi-developer-environments-on-aws-using-gitlab--terraform--serverless--react\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,a.jsx)(e.span,{className:\"icon icon-link\"})}),\"Multi developer environments on AWS using Gitlab + Terraform + Serverless + React\"]}),`\n`,(0,a.jsx)(e.p,{children:\"Photo by tian kuan on Unsplash\"}),`\n`,(0,a.jsxs)(e.p,{children:[\"We are using Gitlab to deploy our applications directly to AWS through pipelines. If you never heard about Gitlab (\",(0,a.jsx)(e.a,{href:\"https://about.gitlab.com/stages-devops-lifecycle/\",children:\"https://about.gitlab.com/stages-devops-lifecycle/\"}),\"), please feel free to read the Gitlab\\u2019s white papers and understand more about the tools. Maybe you are wondering why we don\\u2019t use Github/Actions to deploy our applications, and I\\u2019ll answer you with a simple reason: Runners (\",(0,a.jsx)(e.a,{href:\"https://docs.gitlab.com/ee/ci/runners/\",children:\"https://docs.gitlab.com/ee/ci/runners/\"}),\").\"]}),`\n`,(0,a.jsx)(e.p,{children:\"In this project, we used a front-end application based on React and deployed on CloudFront + S3. Also, a backend application based on the Serverless framework deployed on API Gateway. Both were simple applications that were consuming some 3rd party API and a database in Dynamo DB.\"}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:\"https://cdn-images-1.medium.com/max/2000/1*SYy4KGSFpLvepUz4lS46UQ.png\",alt:\"\"})}),`\n`,(0,a.jsx)(e.p,{children:\"Sometimes we would like to test some new feature that is being developed using our workspace the Development on AWS. It is very simple when we have a small team, and it is easy to do internal management, but sometimes we start to face some problems because another developer would like to test his new feature as well and this would cause confusion, as the second developer would need to merge/rebase the code and that would mean more time and nowadays time is money. \\u{1F911}\"}),`\n`,(0,a.jsx)(e.p,{children:\"We can fix that problem creating a new workspace on AWS for each developer and we can share the resources between them or have one resource per developer, in this case, we will share the resources between the developer since we\\u2019re looking for cost optimisation as well.\"}),`\n`,(0,a.jsxs)(e.p,{children:[`Let\\u2019s look at some code. We\\u2019re using Terraform and a concept called workspaces if you never heard about that you may check our blog post talking about Terraform Workspaces.\n`,(0,a.jsxs)(e.a,{href:\"https://medium.com/dnx-labs/terraform-workspaces-101-f8e1a5054547\",children:[(0,a.jsx)(e.strong,{children:\"Terraform Workspaces 101\"}),`\n`,(0,a.jsx)(e.em,{children:\"The art of deploying the same stack multiple times without duplication\"}),\"medium.com\"]})]}),`\n`,(0,a.jsxs)(e.h2,{id:\"terraform--deploy-infrastructure-as-code-iac\",children:[(0,a.jsx)(e.a,{href:\"#terraform--deploy-infrastructure-as-code-iac\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,a.jsx)(e.span,{className:\"icon icon-link\"})}),\"Terraform \\u2014 Deploy Infrastructure as Code (IaC)\"]}),`\n`,(0,a.jsxs)(e.h3,{id:\"frontend--cloud-front--s3-bucket\",children:[(0,a.jsx)(e.a,{href:\"#frontend--cloud-front--s3-bucket\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,a.jsx)(e.span,{className:\"icon icon-link\"})}),\"Frontend \\u2014 Cloud Front + S3 Bucket\"]}),`\n`,(0,a.jsx)(\"iframe\",{src:\"https://medium.com/media/2bd7f0796357596e3d596f92daf0d489\"}),`\n`,(0,a.jsxs)(e.h3,{id:\"backend--api-gateway\",children:[(0,a.jsx)(e.a,{href:\"#backend--api-gateway\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,a.jsx)(e.span,{className:\"icon icon-link\"})}),\"Backend \\u2014 API Gateway\"]}),`\n`,(0,a.jsx)(\"iframe\",{src:\"https://medium.com/media/caa9dc35c0fb4e6d10f90efe895dc6a1\"}),`\n`,(0,a.jsxs)(e.h3,{id:\"variables\",children:[(0,a.jsx)(e.a,{href:\"#variables\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,a.jsx)(e.span,{className:\"icon icon-link\"})}),\"Variables\"]}),`\n`,(0,a.jsxs)(e.p,{children:[(0,a.jsx)(\"iframe\",{src:\"https://medium.com/media/09d68c83d8fadde917c8eee89ac8e421\"}),`> We\\u2019re using our\n`,(0,a.jsx)(e.strong,{children:\"Terraform\"}),` modules to create most of the resources. All the code and tools that we\\u2019re using is\n**Open Source **so if you want to check this out, you will find all the terraform modules and tools\nthat we\\u2019ve on this link: `,(0,a.jsx)(e.a,{href:\"https://modules.dnx.one/\",children:\"https://modules.dnx.one/\"}),\".\"]}),`\n`,(0,a.jsx)(e.p,{children:\"Look\\u2019s nice but how we know each developer and deploy the code in the right workspace?\"}),`\n`,(0,a.jsxs)(e.p,{children:[\"Gitlab provides us with many environment variables that we can use (\",(0,a.jsx)(e.a,{href:\"https://docs.gitlab.com/ee/ci/variables/predefined_variables.html\",children:\"https://docs.gitlab.com/ee/ci/variables/predefined_variables.html\"}),\") in this case we\\u2019ll use on the pipeline. The variable we can use to separate the environments could be the \",(0,a.jsx)(e.strong,{children:\"GITLAB_USER_ID.\"})]}),`\n`,(0,a.jsxs)(e.h3,{id:\"gitlab-ci\",children:[(0,a.jsx)(e.a,{href:\"#gitlab-ci\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,a.jsx)(e.span,{className:\"icon icon-link\"})}),\"Gitlab CI\"]}),`\n`,(0,a.jsx)(\"iframe\",{src:\"https://medium.com/media/9c285dfaac71720bf50e99f5201b8144\"}),`\n`,(0,a.jsxs)(e.p,{children:[\"In this case, we set the pipeline to run the stage developer just when we deploy a variable called DEVELOPER_ID. This variable is the **GITLAB_USER_ID **that we found before and you can grab this on your Gitlab\\u2019s profile account (\",(0,a.jsx)(e.a,{href:\"https://gitlab.com/profile\",children:\"https://gitlab.com/profile\"}),\") and get the \",(0,a.jsx)(e.strong,{children:\"User ID\"}),\" field. Now that we have our developer\\u2019s user id, we can run our pipeline to create the user workspace using Terraform:\"]}),`\n`,(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.img,{src:\"https://cdn-images-1.medium.com/max/2560/1*ul78U7dxq3zg7Nz9wROS7w.png\",alt:\"Run Pipeline \\u2014 Gitlab CI\"}),(0,a.jsx)(e.em,{children:\"Run Pipeline \\u2014 Gitlab CI\"})]}),`\n`,(0,a.jsx)(e.p,{children:\"The result will be:\"}),`\n`,(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.img,{src:\"https://cdn-images-1.medium.com/max/2752/1*bkmGgBrx2d3dcT2SmTjN3g.png\",alt:\"Pipeline Running - Gitlab CI\"}),(0,a.jsx)(e.em,{children:\"Pipeline Running - Gitlab CI\"})]}),`\n`,(0,a.jsxs)(e.p,{children:[\"We can use the Gitlab CI to apply our code using terraform and creating the new developer just when we set the variable \",(0,a.jsx)(e.strong,{children:\"USER_ID\"}),\".\"]}),`\n`,(0,a.jsx)(e.p,{children:\"Now that we have our workspace deployed, let's move on and create our pipeline for our applications.\"}),`\n`,(0,a.jsx)(\"iframe\",{src:\"https://medium.com/media/868d3177f737c470e41e1aba313bbba8\"}),`\n`,(0,a.jsxs)(e.p,{children:[\"As we\\u2019re creating the API Gateway by developer we want each developer to have their own subdomain so we will use an \",(0,a.jsx)(e.strong,{children:\"API Gateway Custom Domain Name\"}),\" to have an endpoint pointing to the right API Gateway:\"]}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.a,{href:\"https://api-GITLAB_USER_ID.dev.cloud.example.com.au/\",children:[\"https://api-\",(0,a.jsx)(e.strong,{children:\"GITLAB_USER_ID\"}),\".dev.cloud.example.com.au/\"]})}),`\n`,(0,a.jsx)(e.p,{children:\"We also will change a bit our Serverless pipeline to grab the **GITLAB_USER_ID **and use inside for our code as an environment variable.\"}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:\"https://cdn-images-1.medium.com/max/4232/1*pYbWbcDpvZ7Ezb6VvYMUQg.png\",alt:\"\"})}),`\n`,(0,a.jsx)(\"iframe\",{src:\"https://medium.com/media/a49a016aae5d36613f348c7ab04f5230\"}),`\n`,(0,a.jsx)(e.p,{children:\"Now when the developer does a commit into Gitlab the pipeline will trigger and grab the code that he is developing and deploy into his workspace on AWS.\"}),`\n`,(0,a.jsx)(e.p,{children:\"I hope that this article could be useful for you. Let me know in the comments if you have some doubts about that.\"})]});return t?(0,a.jsx)(t,Object.assign({},n,{children:r})):r}var y=v;return I;})();\n;return Component.default;","frontMatter":{"readingTime":{"text":"4 min read","minutes":3.62,"time":217200,"words":724},"slug":"multi-developer-environments-on-aws-using-gitlab-terraform-serverless-react","fileName":"multi-developer-environments-on-aws-using-gitlab-terraform-serverless-react.mdx","title":"Multi developer environments on AWS using Gitlab + Terraform + Serverless + React","date":"2020-05-06","tags":["serverless","gitlab","terraform","react","aws"],"draft":false,"summary":"How you can deploy your applications and separate them by developer using Terraform and Gitlab CI."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.605,"time":36300,"words":121},"slug":["default"],"fileName":"default.md","name":"Bruno Valenga","avatar":"/static/images/avatar.jpg","occupation":"DevOps Engineer","company":"DNX Solutions","email":"brunodasilvalenga@gmail.com","linkedin":"https://www.linkedin.com/in/bruno-da-silva-valenga","github":"https://github.com/brunodasilvalenga","instagram":"https://instagram.com/brunodasilvalenga","devdotto":"https://dev.to/brunodasilvalenga","medium":"https://medium.com/@brunodasilvalenga"}],"prev":null,"next":{"title":"Using Multiple Buckets AWS Amplify","date":"2020-05-20","tags":["amplify","s3-bucket","aws"],"draft":false,"summary":"From the Amplify documentation, we can consider that AWS Amplify is a development platform for building secure, scalable mobile and web…","slug":"using-multiple-buckets-aws-amplify"}},"__N_SSG":true}